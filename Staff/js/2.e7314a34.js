(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"35d2":function(t,e,a){},"5f87":function(t,e,a){"use strict";a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return n}));var s=a("515f");const r="Admin-Token";function o(){return s["a"].get(r)}function n(t){return s["a"].set(r,t)}},"625a":function(t,e,a){"use strict";a("fd77")},"751a":function(t,e,a){"use strict";(function(t){a.d(e,"a",(function(){return d}));a("e6cf");var s=a("bc3a"),r=a.n(s),o=a("5f87"),n=a("4328"),i=a.n(n),c=a("a18c");function d(e={}){let a=r.a.create({baseURL:t.env.VUE_APP_API});a.interceptors.request.use((function(t){if("post"===t.method)t.data=i.a.stringify(t.data);else if("file"===t.method&&(t.method="post",t.data&&t.data instanceof Object)){let e=new FormData;for(let a in t.data)e.append(a,t.data[a]);t.data=e}return t}),(function(t){return Promise.reject(t)})),a.interceptors.response.use((function(t){return 401==t.data.code&&c["a"].push("/login"),t}),(function(t){return Promise.reject(t)}));let s=Object(o["a"])();return e.headers={token:s},a.request(e).then((t=>t.data))}}).call(this,a("4362"))},cb42:function(t,e,a){"use strict";a("35d2")},e69b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"q-pa-md",staticStyle:{height:"400px"}},[a("q-layout",{staticClass:"shadow-2 rounded-borders",style:{height:t.WinHeight+"px"},attrs:{view:"lHh lpr lFf",container:""}},[a("q-drawer",{attrs:{"show-if-above":"",width:200,breakpoint:700,elevated:""},model:{value:t.drawerLeft,callback:function(e){t.drawerLeft=e},expression:"drawerLeft"}},[a("q-scroll-area",{staticClass:"fit"},[a("q-list",{attrs:{bordered:""}},[t._l(t.arrContacts,(function(e){return[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:e.RoomId,staticClass:"q-my-sm",attrs:{active:e.RoomId===t.curUser.RoomId,clickable:""},on:{click:function(a){return t.onClickContacts(e)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{color:"primary","text-color":"white"}},[t._v("\n                    "+t._s(e.Letter)+"\n                  ")])],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.RoomName))]),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.Content))])],1)],1)]}))],2)],1)],1),a("q-page-container",[a("q-page",{attrs:{padding:""}},[a("q-page-sticky",{attrs:{expand:"",position:"top"}},[a("div",{staticClass:"headerBox"},[a("q-toolbar",[a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"menu"},on:{click:function(e){t.drawerLeft=!t.drawerLeft}}}),a("q-toolbar-title",[t._v(t._s(t.curUser.UserName))]),a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"menu"},on:{click:function(e){t.drawerRight=!t.drawerRight}}})],1)],1)]),a("div",{staticClass:"chatMsgBox",style:{height:t.WinHeight-250+"px"}},[a("q-scroll-area",{ref:"scrollChatMsgBox",staticClass:"fit"},[t._l(t.activeMsg,(function(t){return[a("QChatMsg",{attrs:{"created-at":t.CreatedAt,letter:t.Letter,nickname:t.UserName,Way:t.Way,Content:t.Content,"chat-type":t.ChatType,"game-id":t.GameId}})]}))],2)],1),a("q-page-sticky",{attrs:{expand:"",position:"bottom"}},[a("div",{staticClass:"chatBox row"},[a("q-input",{staticClass:"col-12 edit",attrs:{type:"textarea",outlined:"",dense:!0},model:{value:t.ChatMsg,callback:function(e){t.ChatMsg=e},expression:"ChatMsg"}}),a("div",{staticClass:"row col-12 justify-end"},[a("q-file",{staticStyle:{"max-width":"300px"},attrs:{outlined:"",label:"图片","max-file-size":"204800"},on:{rejected:t.onRejected,input:t.onUpload},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0}]),model:{value:t.filesMaxSize,callback:function(e){t.filesMaxSize=e},expression:"filesMaxSize"}}),a("q-btn",{staticClass:"chatBtn",attrs:{color:"primary",icon:"mail",label:"发送"},on:{click:t.doSendAdminChat}})],1)],1)])],1)],1)],1)],1)},r=[],o=(a("fb6a"),a("a434"),a("ddb0"),a("751a"));function n(t){return Object(o["a"])({url:"chat/getchat",method:"post",data:t})}function i(t){return Object(o["a"])({url:"chat/sendadminchat",method:"post",data:t})}function c(t){return Object(o["a"])({url:"chat/sendchat",method:"post",data:t})}function d(t){return Object(o["a"])({url:"chat/sendpic",method:"file",data:t})}function l(t){return Object(o["a"])({url:"chat/getlatelychatuser",method:"file",data:t})}var h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[0==t.Way?[0==t.ChatType?a("q-chat-message",{attrs:{sent:"",stamp:t.CreatedAt,name:t.nickname,text:[t.Content]},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-avatar",{attrs:{color:"primary","text-color":"white"}},[t._v("\n            "+t._s(t.letter)+"\n          ")])]},proxy:!0}],null,!1,3571724484)}):t._e(),1==t.ChatType?a("q-chat-message",{attrs:{sent:"",stamp:t.CreatedAt,name:t.nickname},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-avatar",{attrs:{color:"primary","text-color":"white"}},[t._v("\n            "+t._s(t.letter)+"\n          ")])]},proxy:!0}],null,!1,3571724484)},[a("q-img",{staticClass:"rounded-borders",staticStyle:{width:"150px"},attrs:{src:t.Content,ratio:1,basic:"","spinner-color":"white"}})],1):t._e()]:1==t.Way?[0==t.ChatType?a("q-chat-message",{attrs:{stamp:t.CreatedAt,name:t.nickname,text:[t.Content]},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-avatar",{attrs:{color:"primary","text-color":"white"}},[t._v("\n            "+t._s(t.letter)+"\n          ")])]},proxy:!0}],null,!1,3571724484)}):t._e(),1==t.ChatType?a("q-chat-message",{attrs:{stamp:t.CreatedAt,name:t.nickname},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-avatar",{attrs:{color:"primary","text-color":"white"}},[t._v("\n            "+t._s(t.letter)+"\n          ")])]},proxy:!0}],null,!1,3571724484)},[a("q-img",{staticClass:"rounded-borders",staticStyle:{width:"150px"},attrs:{src:t.Content,ratio:1,basic:"","spinner-color":"white"}})],1):t._e()]:[a("div",{staticClass:"loadM"},[t._v("加载理多")])]],2)},m=[],p={name:"QChatMsg",props:{letter:{type:String,default:"B"},nickname:{type:String,default:"false"},CreatedAt:{type:String,default:"false"},GameId:{type:Number,default:0},Way:{type:Number,default:0},ChatType:{type:Number,default:0},Content:{type:String,default:"fdsaf"}}},u=p,g=(a("cb42"),a("2877")),C=a("8169"),M=a("cb32"),f=a("068f"),y=a("eebe"),I=a.n(y),v=Object(g["a"])(u,h,m,!1,null,"9c0025e8",null),b=v.exports;I()(v,"components",{QChatMessage:C["a"],QAvatar:M["a"],QImg:f["a"]});var q=a("0831");const{getScrollHeight:x}=q["a"];var R={name:"ChatMain",components:{QChatMsg:b},data(){return{filesMaxSize:null,ChatMsg:"",model:"",drawerLeft:!0,mapChatMsg:{MinChatId:0,MaxChatId:0,MapMsg:{}},activeMsg:[{RoomId:1,Letter:"张",UserName:"客服1",GameId:1,Way:1,ChatType:0,Content:"https://cdn.quasar.dev/img/discord-omq.png"},{RoomId:1,Letter:"张",UserName:"张三",GameId:1,Way:0,ChatType:1,Content:"https://cdn.quasar.dev/img/discord-omq.png"},{RoomId:1,Letter:"张",UserName:"33",GameId:1,Way:2,ChatType:1,Content:"https://cdn.quasar.dev/img/discord-omq.png"}],curUser:{RoomId:0,UserName:"客服1",Content:"fdaf safsda",letter:"客",GameId:1},arrContacts:[]}},methods:{doSendAdminChat(){if(0==this.curUser.RoomId)return void this.$q.notify({message:"请点击用户.",color:"purple",position:"center",timeout:100});let t={GameId:this.curUser.GameId,ChatType:0,RoomId:this.curUser.RoomId,Content:this.ChatMsg};i(t).then((t=>{const{obj:e,code:a,msg:s}=t;200==a?(this.ChatMsg="",this.disposeChatMsg(e)):this.$q.notify({message:s,color:"purple",position:"center",timeout:100})})).catch((t=>{}))},doTest(){console.log(this.mapChatMsg),this.$refs["scrollChatMsgBox"].setScrollPosition(1e4)},doTest1(){this.mapChatMsg.MapMsg["134"]=[{RoomId:134,UserName:"33",GameId:1,Way:1,ChatType:1,Content:"aaa"}]},doSendChat(){let t={GameId:this.curUser.GameId,ChatType:0,RoomId:this.curUser.RoomId,Content:this.ChatMsg};c(t).then((t=>{const{obj:e,code:a,msg:s}=t;console.log(e),this.ChatMsg=""})).catch((t=>{}))},disposeChatMsg(t){this.mapChatMsg.MaxChatId=t.MaxChatId;for(let e in t.MapMsg){let a=this.mapChatMsg.MapMsg[e];if(void 0===a){this.mapChatMsg.MapMsg[e]=t.MapMsg[e];let[a]=this.mapChatMsg.MapMsg[e].ArrMsg.slice(-1),s={Id:a.Id,UserName:a.UserName,RoomId:a.RoomId,Content:a.Content,Letter:a.Letter};this.arrContacts.splice(0,0,s)}else this.mapChatMsg.MapMsg[e].ArrMsg=this.mapChatMsg.MapMsg[e].ArrMsg.concat(t.MapMsg[e].ArrMsg),this.mapChatMsg.MapMsg[e].MaxChatId=t.MapMsg[e].MaxChatId,e==this.curUser.RoomId&&(this.activeMsg=this.activeMsg.concat(t.MapMsg[e].ArrMsg))}for(let e=0;e<this.arrContacts.length;e++){let[t]=this.mapChatMsg.MapMsg[this.arrContacts[e].RoomId].ArrMsg.slice(-1);this.arrContacts[e].Content=t.Content}},doGetChat(){n({}).then((t=>{const{obj:e,code:a,msg:s}=t;this.disposeChatMsg(e)})).catch((t=>{}))},onClickContacts(t){this.curUser=t;this.mapChatMsg.MapMsg[t.RoomId];this.activeMsg=this.mapChatMsg.MapMsg[this.curUser.RoomId].ArrMsg},onLoad(t,e){console.log(t,"aa"),e()},onRejected(t){this.$q.notify({type:"negative",message:"图片过大"})},onUpload(t){if(0==this.curUser.RoomId)return void this.$q.notify({message:"请点击用户.",color:"purple",position:"center",timeout:100});this.filesMaxSize=t;let e={GameId:this.curUser.GameId,ChatType:1,RoomId:this.curUser.RoomId,Content:this.ChatMsg,File:t};d(e).then((t=>{const{obj:e,code:a,msg:s}=t;200==a&&this.disposeChatMsg(e)})).catch((t=>{}))},onGetLatelyChatUser(){let t={MaxId:0,PageIndex:1,PageSize:100,UserName:""};l(t).then((e=>{const{obj:a,code:s,msg:r}=e;if(200==s)if(1==t.PageIndex){this.arrContacts=a.DataList;for(let t=0;t<this.arrContacts.length;t++){let e=this.arrContacts[t],a=this.mapChatMsg.MapMsg[e.RoomId];if(void 0===a){console.log(e),this.mapChatMsg.MapMsg[e.RoomId]=e.ChatInfo;let[t]=this.mapChatMsg.MapMsg[e.RoomId].ArrMsg.slice(-1)}else this.mapChatMsg.MapMsg[e.RoomId].ArrMsg=this.mapChatMsg.MapMsg[e.RoomId].ArrMsg.concat(e.ArrMsg),this.mapChatMsg.MapMsg[e.RoomId].MaxChatId=e.MaxChatId;if(e.MinChatId>0){let[t]=e.ArrMsg.slice(-1);e.Content=t.Content}}this.arrContacts.length>0&&(this.curUser=this.arrContacts[0],this.activeMsg=this.mapChatMsg.MapMsg[this.curUser.RoomId].ArrMsg)}else this.arrContacts=this.arrContacts.concat(this.arrContacts=a.DataList);else this.$q.notify({message:r,color:"purple",position:"center",timeout:100})})).catch((t=>{}))}},computed:{WinHeight(){return this.$q.screen.height-40}},mounted(){this.timer?clearInterval(this.timer):this.timer=setInterval(this.doGetChat,2e4)},created(){this.onGetLatelyChatUser(),this.doGetChat()},destroyed(){clearInterval(this.timer)}},_=R,w=(a("625a"),a("4d5a")),U=a("9404"),k=a("4983"),A=a("1c1c"),S=a("66e5"),Q=a("4074"),L=a("0170"),j=a("09e3"),T=a("9989"),G=a("de5e"),N=a("65c6"),P=a("9c40"),W=a("6ac5"),O=a("27f9"),$=a("7d53"),B=a("0016"),z=a("714f"),H=Object(g["a"])(_,s,r,!1,null,"0142e002",null);e["default"]=H.exports;I()(H,"components",{QLayout:w["a"],QDrawer:U["a"],QScrollArea:k["a"],QList:A["a"],QItem:S["a"],QItemSection:Q["a"],QAvatar:M["a"],QItemLabel:L["a"],QPageContainer:j["a"],QPage:T["a"],QPageSticky:G["a"],QToolbar:N["a"],QBtn:P["a"],QToolbarTitle:W["a"],QInput:O["a"],QFile:$["a"],QIcon:B["a"]}),I()(H,"directives",{Ripple:z["a"]})},fd77:function(t,e,a){}}]);